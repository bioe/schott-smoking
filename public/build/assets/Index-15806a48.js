import{r as A,v as D,c,a as m,u as l,w as _,F as v,o as r,X as L,b as p,t as a,d as t,g as T,e as b,f as x,I as O,h as w,i as M,p as R,j as F,H,O as P}from"./app-81228d10.js";import{P as U}from"./PrimaryButton-76c31b25.js";import{H as V}from"./HeadRow-96fd1d22.js";import{_ as K}from"./Paginate-55f629eb.js";import{A as q}from"./AuthenticatedLayout-aaed9277.js";import{f as C}from"./helper-449b5e06.js";import"./_plugin-vue_export-helper-c27b6911.js";const z={class:"my-3 p-3 bg-body rounded shadow-sm"},G=["onSubmit"],Q={class:"row mb-3"},X={class:"col-md-3"},Y={class:"form-floating mb-3"},J=t("label",{for:"keywordInput"},"Keyword",-1),W={class:"col-md-3"},Z={class:"form-floating mb-3"},tt=t("label",{for:"startInput"},"Entry",-1),et={class:"col-md-3"},ot={class:"form-floating mb-3"},st=t("label",{for:"endInput"},"Exit",-1),lt={class:"col-md-3"},nt={class:"form-floating mb-3"},it=t("option",{value:null},"All",-1),at=["value"],dt=t("label",{for:"stationInput"},"Station",-1),rt={class:"col-md-3"},ct={class:"form-floating mb-3"},ut=t("option",{value:null},"All",-1),ft=t("option",{value:"yes"},"Yes",-1),mt=t("option",{value:"no"},"No",-1),_t=[ut,ft,mt],pt=t("label",{for:"stationInput"},"Overstay",-1),bt={class:"col-12 d-flex justify-content-between"},yt=t("i",{class:"bi bi-search"},null,-1),ht=t("i",{class:"bi bi-filetype-csv"},null,-1),vt={class:"table table-bordered table-striped table-hover"},gt={width:"10%"},xt=["onClick"],wt=t("i",{class:"bi bi-trash"},null,-1),kt=[wt],Vt={__name:"Index",props:{header:{type:Object},filters:{type:Object},list:{type:Object,default:()=>({})},station_list:{type:Object}},setup(u){const k=u;k.filters.is_export=0;const g="entrylogs",I=A("Entry Logs"),s=D(k.filters),N=n=>{s.sort.field=n,s.sort.direction=s.sort.direction==""||s.sort.direction=="desc"?"asc":"desc",j()};function S(n,o=""){return Object.keys(n).map(e=>{let i=n[e],d=o?`${o}[${e}]`:e;return i!==null&&typeof i=="object"?S(i,d):(i==null&&(i=""),`${d}=${encodeURIComponent(`${i}`.replace(/\s/g,"_"))}`)}).join("&")}const j=()=>{if(s.is_export){let n=S(s.data());H.get(route(g+".index")+"?"+n,{responseType:"blob"}).then(o=>{const e=o.headers["content-type"],i=o.headers["content-disposition"];let d="exportfile";if(i){const h=i.match(/filename="(.+)"/);h&&h.length===2&&(d=h[1])}const y=new Blob([o.data],{type:e,encoding:"UTF-8"}),f=document.createElement("a");f.href=window.URL.createObjectURL(y),f.download=d,f.click()})}else s.get(route(g+".index"),{preserveScroll:!0})},B=(n,o)=>{confirm(`Delete this entry ${o} ?`)&&P.delete(route(g+".destroy",n))},$=n=>{s.is_export=n};return(n,o)=>(r(),c(v,null,[m(l(L),{title:I.value},null,8,["title"]),m(q,null,{header:_(()=>[p(a(I.value),1)]),default:_(()=>[t("div",z,[t("form",{onSubmit:T(j,["prevent"])},[t("div",Q,[t("div",X,[t("div",Y,[b(t("input",{"onUpdate:modelValue":o[0]||(o[0]=e=>l(s).keyword=e),type:"text",class:"form-control",id:"keywordInput",placeholder:"Keyword",autocomplete:"off"},null,512),[[x,l(s).keyword]]),J])]),t("div",W,[t("div",Z,[b(t("input",{"onUpdate:modelValue":o[1]||(o[1]=e=>l(s).start=e),type:"date",class:"form-control",id:"startInput",placeholder:"Start",autocomplete:"off"},null,512),[[x,l(s).start]]),tt])]),t("div",et,[t("div",ot,[b(t("input",{"onUpdate:modelValue":o[2]||(o[2]=e=>l(s).end=e),type:"date",class:"form-control",id:"endInput",placeholder:"End",autocomplete:"off"},null,512),[[x,l(s).end]]),st])]),t("div",lt,[t("div",nt,[b(t("select",{"onUpdate:modelValue":o[3]||(o[3]=e=>l(s).station_id=e),class:"form-select"},[it,(r(!0),c(v,null,w(u.station_list,e=>(r(),c("option",{value:e.id},a(e.name),9,at))),256))],512),[[O,l(s).station_id]]),dt])]),t("div",rt,[t("div",ct,[b(t("select",{"onUpdate:modelValue":o[4]||(o[4]=e=>l(s).overstay=e),class:"form-select"},_t,512),[[O,l(s).overstay]]),pt])]),t("div",bt,[m(U,{type:"submit",disabled:l(s).processing,onClick:o[5]||(o[5]=e=>$(0))},{default:_(()=>[yt,p(" Search ")]),_:1},8,["disabled"]),m(U,{type:"submit",disabled:l(s).processing,onClick:o[6]||(o[6]=e=>$(1))},{default:_(()=>[ht,p(" Export ")]),_:1},8,["disabled"])])])],40,G),t("table",vt,[t("thead",null,[t("tr",null,[m(V,null,{default:_(()=>[p("Actions")]),_:1}),(r(!0),c(v,null,w(u.header,e=>(r(),M(V,{field:e.field,sort:e.sortable?u.filters.sort:null,onSortEvent:N,disabled:l(s).processing},{default:_(()=>[p(a(e.title),1)]),_:2},1032,["field","sort","disabled"]))),256))])]),t("tbody",null,[(r(!0),c(v,null,w(u.list.data,(e,i)=>{var d,y,f;return r(),c("tr",null,[t("td",gt,[e.can_delete_entry?(r(),c("button",{key:0,onClick:h=>{var E;return B(e.id,(E=e.employee)==null?void 0:E.card_id)},class:"btn btn-sm btn-link"},kt,8,xt)):R("",!0)]),t("td",null,a((d=e.employee)==null?void 0:d.staff_no),1),t("td",null,a((y=e.employee)==null?void 0:y.name),1),t("td",null,a((f=e.station)==null?void 0:f.name),1),t("td",null,a(l(C)(e.enter_time)),1),t("td",null,a(l(C)(e.exit_time)),1),t("td",{class:F(e.overstay_seconds>0?"text-danger":"")},a(e.stay_label),3)])}),256))])]),m(K,{data:u.list},null,8,["data"])])]),_:1})],64))}};export{Vt as default};
